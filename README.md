# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт

```
interface IProduct {
    id: number;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
}
```

Интерфейс для модели данных продуктов

```
interface IAppData {
    products: IProduct[];
    preview: string | null;
    order: IOrder;
    basket: IProduct[];
	events: IEvents;
	formErrors: FormErrors = {};
    clearBasket();
	clearOrder() {
        this.order = {
            payment: '',
            items: [],
            total: 0,
            email: '',
            phone: '',
            address: ''
        }
    };
	removeFromBasket(id: string);
    addToBasket(item: IProduct);
	setProducts(items: IProduct[]);
	setPreview(item: IProduct);
	getTotalPrice(): number;
	getOrderProducts(): IProduct[];
	productOrder(item: IProduct): boolean;
	setPaymentMethod(method: string);
	setOrderDeliveryField(value: string);
	setOrderContactField(field: keyof IContactForm, value: string);
	validateDelivery();
	validateContact();
}
```

Заказ

```
interface IOrder extends IOrderFormError {
    items: string[],
    total: number;
    payment: TPayment,
}
```

Интерфейс для модели данных заказа

```
interface IOrderResult {
	id: string;
	total: number;
}
```

Корзина

```
interface IBasket {
	items: IBasketItem[];
	total: number;
}
```

Категория товара

```
type TCategory = 'софт-скил' | 'хард-скил' | 'кнопка' | 'дополнительное' | 'другое';
```

Тип оплаты

```
type TPayment =  'card' | 'cash' | '';
```

Данные продукта, используемые в корзине

```
export type IBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

Данные заказа, используемые в форме при создании заказа

```
export interface IShippingForm {
    payment: TPayment,
    address: string,
}
```

Данные заказа, используемые во второй форме при создании заказа

```
interface IContactForm {
    email: string,
    phone: string,
}
```

Валидация вводимых данных пользователем

```
export type FormError = Partial<Record<keyof IOrder, string>>
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс AppApi
Класс LarekAPI расширяет класс `Api`, реализуя интерфейс IAppApi. Он обеспечивает структурированное взаимодействие между клиентским приложением и сервером, упрощая работу с данными о товарах и заказах.
- `constructor(cdn: string, baseUrl: string, options?: RequestInit)` - Позволяет инициализировать экземпляр API-клиента с настройками:
-	`cdn` — URL-адрес для загрузки изображений.
-	`baseUrl` — базовый адрес API, к которому будут отправляться запросы.
-	`options` — необязательные параметры для настройки сетевых запросов.

Методы:
-	`getProduct(id: string): Promise<IProduct>` — выполняет запрос на сервер для получения данных о конкретном продукте по его идентификатору.
-	`getProductList(): Promise<IProduct[]>` — запрашивает полный перечень товаров, доступных в системе.
-	`orderProduct(order: IOrder): Promise<IOrderResult>` — отправляет сведения о заказе на сервер и возвращает результат оформления.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

## Слой данных

### Класс AppData
Хранит глобальное состояние приложения, включая информацию о корзине, каталоге продуктов, заказе и ошибках формы.

Поля класса:
- `products: IProduct[]` - массив продуктов
- `preview: string | null` - id продукта, выбранный для просмотра в модальном окне
- `order: IOrder` - текущий заказ
- `basket: IProduct[]` - корзина товаров
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- `formErrors: FormErrors` - объект, содержащий ошибки формы.

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- `clearBasket()` - очистка корзины
- `clearOrder()` - очистка заказа
- `addToBasket(item: IProduct)` - метод для добавления товара в корзину
- `removeFromBasket(id: string)` - метод для удаления товара из корзины
- `getOrderProducts(): IProduct[]` - метод возвращает товары из заказа
- `getTotalPrice(): number` - метод возвращает полную стоимость корзины
- `productOrder(item: IProduct): boolean` - проверка на наличие товара в заказе
- `setPaymentMethod(method: string)` - установка способа оплаты
- `setOrderDeliveryField(value: string)` - установка адруса доставки
- `setOrderContactField(field: keyof IContactForm, value: string)` - установка контактных данных
- `validateDelivery()` - проверка данных о доставке
- `validateContact()` - проверка контактных данных

## Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

### Класс Component
Абстрактный базовый класс, предназначенный для создания и управления элементами пользовательского интерфейса. Обеспечивает удобные методы для манипуляции DOM-структурой и поведения компонентов. Наследуется всеми представлениями (View).

Конструктор

`constructor(container: HTMLElement)` — принимает контейнерный элемент, в который будет встроен компонент.

Методы
- `toggleClass` — добавляет или удаляет указанный класс у переданного элемента, переключая его состояние.
- `setText` — изменяет текстовое содержимое указанного элемента.
- `setImage` — устанавливает изображение и (опционально) альтернативный текст для переданного элемента типа HTMLImageElement.
- `setDisabled` — управляет доступностью элемента, блокируя или разблокируя его.
- `setHidden, setVisible` — скрывает или делает видимым переданный элемент.
- `render` — базовый метод отрисовки компонента, который должен быть переопределён в дочерних классах.

### Класс Modal
Реализует модальное окно. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа. Наследуется от `Component`.

`constructor(container: HTMLElement, events: IEvents)` — принимает контейнерный элемент для модального окна и объект для обработки событий.

Методы:
- `set content` — задаёт или обновляет содержимое модального окна.
- `open` — открывает модальное окно и инициирует событие открытия.
- `close` — закрывает модальное окно и инициирует событие закрытия.
- `render` — рендерит модальное окно с переданным содержимым и автоматически открывает его.

### Класс Form
Класс для создания и управления интерактивными формами. Обеспечивает обработку событий ввода и отправки, отслеживает состояние валидации и управляет отображением формы. Наследуется от Component.

Конструктор

`constructor(container: HTMLFormElement, events: IEvents)` — принимает контейнер формы и объект для обработки событий.

Методы:
- `onInputChange` — обработчик ввода, который отслеживает изменения в полях формы и эмиттирует соответствующие события.
- `set valid` — установка состояния кнопки.
- `set errors` — применяет и отображает ошибки валидации, обеспечивая обратную связь с пользователем.
- `render` — обновляет состояние формы, устанавливая актуальные ошибки, валидность и введённые значения.

### Класс Page

Класс, управляющий основными элементами страницы, такими как каталог товаров, счётчик товаров в корзине и глобальные состояния интерфейса. Позволяет блокировать прокрутку страницы при необходимости. Наследуется от Component.

Конструктор

`constructor(container: HTMLElement, events: IEvents)` — принимает контейнер страницы и объект для обработки событий.

Методы:
- `set counter` — обновляет количество товаров в корзине.
- `set catalog` — заменяет текущее содержимое каталога переданными данными.
- `set locked` — включает или отключает блокировку прокрутки и взаимодействия с интерфейсом.

### Класс BasketModal
Наследуемый класс от `Component`, предназначен для отображения и управления товаров в корзине.\
`constructor(container: HTMLElement, events: EventEmitter)` - принимает контейнер страницы и объект для управлением событий.\
Методы:

- `disableButton` - переключает состояние кнопки.
- `set items` - устанавливает товары в корзине.
- `set total` - устанавливает общую стоимость товаров.

### Класс ShippingForm
Расширяет класс `Form`, предназначен для отображения и управления формой доставки.\
`constructor(container: HTMLFormElement, events: IEvents, actions?: IActions)` - принимает контейнер формы доставки, экземпляр обработчика событий и (опционально) набор действий для обработки пользовательских кликов в форме.

Методы:\
- `toggleButtons` - переключает активность кнопок оплаты.
- `set address` - устанавливает адрес доставки.

### Класс ContactForm
Класс, отвечающий за отображение и управление формой контактной информации, включая ввод номера телефона и email. Наследуется от класса `Form`.

Конструктор

`constructor(container: HTMLFormElement, events: IEvents)` — принимает контейнер формы и объект для управления событиями.

Методы:
- `set phone` — задаёт номер телефона.
- `set email` — устанавливает адрес электронной почты

### Класс Success

Класс для управления компонентом уведомления об успешной операции, например, после завершения заказа или выполнения важного действия. Позволяет динамически обновлять отображаемую информацию. Наследуется от `Component`.

Конструктор

`constructor(container: HTMLElement, actions: ISuccessActions)` — принимает контейнер уведомления и объект для обработки событий.

Методы:
- `set total` — обновляет текстовое отображение суммы завершённой операции.

### ProductCard

Класс, отвечающий за создание, отображение и управление карточками товаров в каталоге, на страницах предпросмотра и в корзине. Также обрабатывает пользовательские события. Реализует интерфейс IProduct. Наследуется от `Component`.

Конструктор

`constructor(container: HTMLElement, actions?: IActions)` — принимает контейнер карточки и (опционально) набор действий, связанных с карточкой.

Методы:
- `disablePriceButton` — проверяет наличие цены и отключает кнопку покупки, если цена отсутствует.
- `set/get id` — управляет уникальным идентификатором карточки.
- `set/get title` — изменяет или получает название товара.
- `set/get price` — устанавливает или возвращает цену товара.
- `set/get category` — задаёт категорию товара и её визуальное отображение.
- `set image` — загружает изображение товара.
- `set description` — обновляет описание товара.
- `set buttonTitle` — изменяет текст кнопки взаимодействия.
